<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#2d3030">
<title>Výkup Palet</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#2d3030; --bg2:#363b3a; --bg3:#414746;
    --border:#4a5050; --white:#f2f2f2; --dim:#999; --muted:#5a6060;
    --red:#d95f5f; --green:#6abf6a;
    --hh:62px; --th:68px;
  }
  *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
  html,body{background:var(--bg);color:var(--white);font-family:'Barlow',sans-serif;min-height:100vh;max-width:480px;margin:0 auto;padding-bottom:90px}

  .header{height:var(--hh);background:var(--bg2);border-bottom:1px solid var(--border);padding:0 16px;position:sticky;top:0;z-index:100;display:flex;align-items:center;justify-content:space-between}
  .logo{display:flex;flex-direction:column;gap:0;line-height:1}
  .logo-top,.logo-bot{font-family:'Barlow Condensed',sans-serif;font-weight:900;font-size:20px;letter-spacing:7px;text-transform:uppercase;color:var(--white)}
  .logo-bot{display:flex;gap:16px}
  .logo-sep{height:1px;background:rgba(255,255,255,.15);margin:2px 0}
  .hdate{text-align:right;font-size:11px;color:var(--dim);line-height:1.6}

  .tbar{height:var(--th);background:var(--bg2);border-bottom:2px solid var(--border);padding:0 16px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:var(--hh);z-index:99}
  .tlbl{font-family:'Barlow Condensed',sans-serif;font-size:11px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--dim)}
  .tpcs{font-size:10px;color:var(--muted);margin-top:2px}
  .tamt{font-family:'Barlow Condensed',sans-serif;font-size:38px;font-weight:900;color:var(--white);letter-spacing:-1px}
  @keyframes blink{0%,100%{opacity:1}50%{opacity:.5}}.blink{animation:blink .25s}

  .plist{padding:10px 12px;display:flex;flex-direction:column;gap:7px}
  .slbl{font-family:'Barlow Condensed',sans-serif;font-size:10px;font-weight:800;letter-spacing:2.5px;text-transform:uppercase;color:var(--muted);padding:6px 4px 2px}

  .prow{background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:10px 12px;display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center;transition:border-color .12s,background .12s}
  .prow.on{border-color:var(--white);background:#404a49}
  .pname{font-family:'Barlow Condensed',sans-serif;font-size:19px;font-weight:700}
  .pprrow{display:flex;align-items:center;gap:6px}
  .pprlbl{font-size:12px;color:var(--dim)}
  .pprinp{background:var(--bg3);border:1px solid var(--border);border-radius:5px;color:var(--white);font-family:'Barlow',sans-serif;font-size:12px;font-weight:600;width:56px;padding:3px 6px;text-align:center;-moz-appearance:textfield}
  .pprinp::-webkit-outer-spin-button,.pprinp::-webkit-inner-spin-button{-webkit-appearance:none}
  .pprinp:focus{outline:none;border-color:var(--white)}
  .psub{font-size:12px;color:var(--dim);font-weight:600;min-height:16px;margin-top:2px}

  .ksc{display:flex;align-items:center;background:var(--bg3);border:1px solid var(--border);border-radius:8px;overflow:hidden}
  .kb{width:42px;height:46px;background:none;border:none;font-size:20px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .08s;user-select:none}
  .kb:active{background:var(--border)}
  .kb.m{color:var(--red)}.kb.p{color:var(--white)}
  .kv{width:46px;text-align:center;font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:800;color:var(--white);background:none;border:none;outline:none;-moz-appearance:textfield}
  .kv::-webkit-outer-spin-button,.kv::-webkit-inner-spin-button{-webkit-appearance:none}

  .bbar{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;background:var(--bg2);border-top:1px solid var(--border);padding:10px 12px;display:flex;gap:8px;z-index:100}
  .btn{padding:13px;border:none;border-radius:9px;font-family:'Barlow Condensed',sans-serif;font-weight:700;letter-spacing:1px;text-transform:uppercase;cursor:pointer;transition:all .12s}
  .bico{background:var(--bg3);color:var(--dim);border:1px solid var(--border);width:50px;font-size:18px;flex-shrink:0}
  .bico:active{background:var(--border)}
  .bconf{flex:1;background:var(--white);color:#2d3030;font-size:16px}
  .bconf:active{background:#ccc;transform:scale(.98)}
  .bconf:disabled{background:var(--border);color:var(--muted);cursor:not-allowed;transform:none}

  .ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.82);z-index:200;align-items:flex-end;justify-content:center}
  .ov.open{display:flex}
  .modal{background:var(--bg2);border-top:2px solid var(--border);border-radius:16px 16px 0 0;width:100%;max-width:480px;padding:20px 16px 40px;max-height:88vh;overflow-y:auto}
  .mhd{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
  .mtit{font-family:'Barlow Condensed',sans-serif;font-size:19px;font-weight:800;letter-spacing:1px;text-transform:uppercase}
  .mclose{background:none;border:none;color:var(--dim);font-size:22px;cursor:pointer;padding:2px 4px;line-height:1}

  .clist{display:flex;flex-direction:column;gap:7px;margin-bottom:16px}
  .crow{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:var(--bg3);border-radius:8px}
  .cnm{font-family:'Barlow Condensed',sans-serif;font-size:18px;font-weight:700}
  .cdt{font-size:13px;color:var(--dim);text-align:right}
  .ctot{display:flex;justify-content:space-between;align-items:center;padding:14px 12px;background:var(--bg3);border:1px solid var(--border);border-radius:8px;margin-bottom:14px}
  .ctlbl{font-family:'Barlow Condensed',sans-serif;font-size:15px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--dim)}
  .ctamt{font-family:'Barlow Condensed',sans-serif;font-size:30px;font-weight:900;color:var(--white)}

  .nwrap{margin-bottom:14px}
  .nlbl{display:block;font-family:'Barlow Condensed',sans-serif;font-size:10px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:6px}
  .ninp{width:100%;background:var(--bg3);border:1px solid var(--border);border-radius:8px;color:var(--white);font-family:'Barlow',sans-serif;font-size:15px;padding:12px 14px;outline:none;transition:border-color .12s}
  .ninp:focus{border-color:var(--white)}.ninp::placeholder{color:var(--muted)}

  .bok{width:100%;padding:15px;background:var(--white);color:#2d3030;border:none;border-radius:9px;font-family:'Barlow Condensed',sans-serif;font-size:17px;font-weight:800;letter-spacing:1px;text-transform:uppercase;cursor:pointer}
  .bok:active{opacity:.85}

  .hlist{display:flex;flex-direction:column;gap:9px}
  .hitem{background:var(--bg3);border-radius:8px;padding:11px 13px;border-left:3px solid var(--border)}
  .hhd{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px}
  .hdate{font-family:'Barlow Condensed',sans-serif;font-size:14px;font-weight:700;color:var(--dim)}
  .htot{font-family:'Barlow Condensed',sans-serif;font-size:19px;font-weight:800;color:var(--white)}
  .hdet{font-size:11px;color:var(--muted);line-height:1.65}
  .hnote{margin-top:4px;font-size:11px;color:var(--dim);font-style:italic}
  .hempty{text-align:center;padding:40px 20px;color:var(--muted);font-size:14px}

  .toast{position:fixed;top:74px;left:50%;transform:translateX(-50%);background:var(--green);color:#1a2020;font-family:'Barlow Condensed',sans-serif;font-size:15px;font-weight:800;letter-spacing:1px;padding:11px 22px;border-radius:8px;z-index:300;opacity:0;transition:opacity .25s;white-space:nowrap;pointer-events:none}
  .toast.on{opacity:1}
</style>
</head>
<body>

<div class="header">
  <div class="logo">
    <div class="logo-top">PALETY</div>
    <div class="logo-sep"></div>
    <div class="logo-bot"><span>VÍ</span><span>T</span></div>
  </div>
  <div class="hdate" id="hdate"></div>
</div>

<div class="tbar">
  <div>
    <div class="tlbl">Celkem k výplatě</div>
    <div class="tpcs" id="tpcs">0 ks</div>
  </div>
  <div class="tamt" id="tamt">0 Kč</div>
</div>

<div class="plist" id="plist"></div>

<div class="bbar">
  <button class="btn bico" onclick="resetAll()">↺</button>
  <button class="btn bconf" id="bconf" onclick="openConfirm()" disabled>Potvrdit výkup</button>
  <button class="btn bico" onclick="openHistory()">☰</button>
</div>

<div class="ov" id="ov-confirm">
  <div class="modal">
    <div class="mhd"><div class="mtit">Souhrn výkupu</div><button class="mclose" onclick="closeOv('ov-confirm')">✕</button></div>
    <div class="clist" id="clist"></div>
    <div class="ctot">
      <div class="ctlbl">K výplatě</div>
      <div class="ctamt" id="ctamt">0 Kč</div>
    </div>
    <div class="nwrap">
      <label class="nlbl">Poznámka</label>
      <input class="ninp" id="ninp" type="text" placeholder="Nepovinná poznámka k výkupu…" maxlength="120" inputmode="text">
    </div>
    <button class="bok" onclick="save()">✓ Uložit &amp; Vyplatit</button>
  </div>
</div>

<div class="ov" id="ov-history">
  <div class="modal">
    <div class="mhd"><div class="mtit">Historie výkupů</div><button class="mclose" onclick="closeOv('ov-history')">✕</button></div>
    <div class="hlist" id="hlist"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const P=[
  {id:'eur_a',  n:'EUR A',       p:150},
  {id:'eur_b',  n:'EUR B',       p:100},
  {id:'eur_ac', n:'EUR AC',      p:40},
  {id:'eur_bc', n:'EUR BC',      p:40},
  {id:'std15',  n:'STD 15',      p:40},
  {id:'std10',  n:'STD 10',      p:40},
  {id:'std05',  n:'STD 05',      p:30},
  {id:'x100',   n:'100×120',     p:50},
  {id:'ohradka',n:'Pal. ohrádka',p:100},
  {id:'cp3',    n:'CP3',         p:50},
];
const G=[
  {l:'EUR PALETY',ids:['eur_a','eur_b','eur_ac','eur_bc']},
  {l:'STANDARDNÍ',ids:['std15','std10','std05']},
  {l:'OSTATNÍ',   ids:['x100','ohradka','cp3']},
];
let C={},PR={};
P.forEach(x=>{C[x.id]=0;PR[x.id]=x.p});
try{const s=localStorage.getItem('vp_pr');if(s)Object.assign(PR,JSON.parse(s))}catch(e){}

const fd=d=>(d?new Date(d):new Date()).toLocaleDateString('cs-CZ',{day:'2-digit',month:'2-digit',year:'numeric'});
const ft=d=>(d?new Date(d):new Date()).toLocaleTimeString('cs-CZ',{hour:'2-digit',minute:'2-digit'});
const ck=()=>document.getElementById('hdate').innerHTML=`<div>${fd()}</div><div>${ft()}</div>`;
ck();setInterval(ck,30000);

function render(){
  const l=document.getElementById('plist');l.innerHTML='';
  G.forEach(g=>{
    const s=document.createElement('div');s.className='slbl';s.textContent=g.l;l.appendChild(s);
    g.ids.forEach(id=>{
      const x=P.find(q=>q.id===id);
      const sub=C[id]>0?`${C[id]} ks × ${PR[id]} = <strong>${(C[id]*PR[id]).toLocaleString('cs-CZ')} Kč</strong>`:'';
      const r=document.createElement('div');
      r.className='prow'+(C[id]>0?' on':'');r.id='r-'+id;
      r.innerHTML=`<div>
        <div class="pname">${x.n}</div>
        <div class="pprrow"><span class="pprlbl">Cena/ks:</span>
          <input class="pprinp" type="number" value="${PR[id]}" onchange="spr('${id}',this.value)" onclick="this.select()" inputmode="numeric">
          <span class="pprlbl">Kč</span></div>
        <div class="psub" id="s-${id}">${sub}</div>
      </div>
      <div class="ksc">
        <button class="kb m" onpointerdown="sr('${id}',-1)" onpointerup="ss()" onpointerleave="ss()">−</button>
        <input class="kv" type="number" value="${C[id]}" id="k-${id}" oninput="sc('${id}',this.value)" onclick="this.select()" inputmode="numeric" min="0">
        <button class="kb p" onpointerdown="sr('${id}',1)" onpointerup="ss()" onpointerleave="ss()">+</button>
      </div>`;
      l.appendChild(r);
    });
  });
}

function spr(id,v){const n=parseInt(v);if(!isNaN(n)&&n>=0){PR[id]=n;localStorage.setItem('vp_pr',JSON.stringify(PR));rf(id)}}
function sc(id,v){const n=parseInt(v);C[id]=(isNaN(n)||n<0)?0:n;rf(id)}
function ac(id,d){C[id]=Math.max(0,(C[id]||0)+d);const e=document.getElementById('k-'+id);if(e)e.value=C[id];rf(id)}

function rf(id){
  const r=document.getElementById('r-'+id),s=document.getElementById('s-'+id);
  if(r)r.className='prow'+(C[id]>0?' on':'');
  if(s)s.innerHTML=C[id]>0?`${C[id]} ks × ${PR[id]} = <strong>${(C[id]*PR[id]).toLocaleString('cs-CZ')} Kč</strong>`:'';
  rt();
}

function rt(){
  let t=0,pc=0;P.forEach(x=>{t+=C[x.id]*PR[x.id];pc+=C[x.id]});
  const e=document.getElementById('tamt');
  e.textContent=t.toLocaleString('cs-CZ')+' Kč';
  e.classList.remove('blink');void e.offsetWidth;e.classList.add('blink');
  document.getElementById('tpcs').textContent=pc+' ks celkem';
  document.getElementById('bconf').disabled=t===0;
}

let rt1,rt2;
function sr(id,d){ac(id,d);rt1=setTimeout(()=>{rt2=setInterval(()=>ac(id,d),75)},350)}
function ss(){clearTimeout(rt1);clearInterval(rt2)}

function resetAll(){if(!confirm('Resetovat?'))return;P.forEach(x=>{C[x.id]=0});render();rt()}

function openConfirm(){
  const a=P.filter(x=>C[x.id]>0);
  const tot=a.reduce((s,x)=>s+C[x.id]*PR[x.id],0);
  document.getElementById('clist').innerHTML=a.map(x=>`
    <div class="crow"><div class="cnm">${x.n}</div>
    <div class="cdt">${C[x.id]} ks × ${PR[x.id]} Kč<br><strong>${(C[x.id]*PR[x.id]).toLocaleString('cs-CZ')} Kč</strong></div></div>`).join('');
  document.getElementById('ctamt').textContent=tot.toLocaleString('cs-CZ')+' Kč';
  document.getElementById('ov-confirm').classList.add('open');
}

function save(){
  const a=P.filter(x=>C[x.id]>0);
  const tot=a.reduce((s,x)=>s+C[x.id]*PR[x.id],0);
  const note=(document.getElementById('ninp').value||'').trim();
  const now=new Date();
  const rec={ts:now.toISOString(),date:fd(now),time:ft(now),total:tot,note,
    items:a.map(x=>({n:x.n,ks:C[x.id],pr:PR[x.id],sub:C[x.id]*PR[x.id]}))};
  const h=gh();h.unshift(rec);localStorage.setItem('vp_hist',JSON.stringify(h.slice(0,200)));
  document.getElementById('ninp').value='';
  closeOv('ov-confirm');
  P.forEach(x=>{C[x.id]=0});render();rt();
  toast('✓ Výkup uložen! '+tot.toLocaleString('cs-CZ')+' Kč');
}

function gh(){try{return JSON.parse(localStorage.getItem('vp_hist')||'[]')}catch(e){return[]}}

function openHistory(){
  const h=gh();
  document.getElementById('hlist').innerHTML=h.length===0
    ?'<div class="hempty">Žádné výkupy zatím nebyly uloženy.</div>'
    :h.map(r=>`<div class="hitem">
      <div class="hhd"><div class="hdate">${r.date} ${r.time||''}</div><div class="htot">${r.total.toLocaleString('cs-CZ')} Kč</div></div>
      <div class="hdet">${r.items.map(i=>`${i.n}: ${i.ks}×${i.pr} = ${i.sub.toLocaleString('cs-CZ')} Kč`).join(' | ')}</div>
      ${r.note?`<div class="hnote">${r.note}</div>`:''}</div>`).join('');
  document.getElementById('ov-history').classList.add('open');
}

function closeOv(id){document.getElementById(id).classList.remove('open')}
document.querySelectorAll('.ov').forEach(el=>el.addEventListener('click',e=>{if(e.target===el)el.classList.remove('open')}));

function toast(msg){
  const t=document.getElementById('toast');t.textContent=msg;
  t.classList.add('on');setTimeout(()=>t.classList.remove('on'),2600);
}

render();rt();
</script>
</body>
</html>
